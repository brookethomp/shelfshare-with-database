<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Profile | ShelfShare</title>
        <link rel="icon" type="image/x-icon" href="icon.png">
        <link rel="stylesheet" href="style.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <!-- For hamburger and social media icons -->
        <style type="text/css">
            .content {
                padding: 20px 20% 50px 20%;
                text-align: justify;
                line-height: 2;
            }
            .content h1 {
                padding-top: 20px;
                padding-bottom: 20px;
                text-align: center;
                line-height: 1.2;
            }

            @media (max-width: 600px) {
                .content {
                    padding: 20px 50px 20px 50px;
                }
            }
        </style>

        <!-- Header -->
        <script src="header.js"></script>
    </head>

<body>
    <script src="header.js"></script>
    
    <div class="content">
        <div id="profileView">
            <h2>Your Profile</h2>
            <p><strong>Name:</strong> <span id="viewProfileName"></span></p>
            <p><strong>Bio:</strong> <span id="viewProfileBio"></span></p>
            <p><strong>Address:</strong> <span id="viewProfileAddress"></span></p>
            <p><strong>Favorite Books:</strong></p>
            <ul id="viewProfileBooks"></ul>
            <button onclick="showEditProfile()">Edit Profile</button>
        </div>

        <div id="profileEdit" style="display: none;">
            <h2>Edit Profile</h2>
            <input type="text" id="editProfileName" placeholder="Name">
            <textarea id="editProfileBio" placeholder="Bio"></textarea>
            <input type="text" id="editProfileAddress" placeholder="Address">
            <textarea id="editProfileBooks" placeholder="Favorite Books (comma-separated)"></textarea>
            <button onclick="updateProfile()">Save Profile</button>
            <button onclick="showProfileView()">Cancel</button>
        </div>
    </div>

    <script>
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));

        document.addEventListener('DOMContentLoaded', () => {
            if (!currentUser) {
                window.location.href = 'index.html';
            }
            document.getElementById('viewProfileName').innerText = currentUser.name || 'No name set';
            document.getElementById('viewProfileBio').innerText = currentUser.bio || 'No bio set';
            document.getElementById('viewProfileAddress').innerText = currentUser.address || 'No address set';
            updateBooksView(currentUser.books || []);
        });

        function showEditProfile() {
            document.getElementById('profileView').style.display = 'none';
            document.getElementById('profileEdit').style.display = 'block';

            document.getElementById('editProfileName').value = currentUser.name || '';
            document.getElementById('editProfileBio').value = currentUser.bio || '';
            document.getElementById('editProfileAddress').value = currentUser.address || '';
            document.getElementById('editProfileBooks').value = (currentUser.books || []).join(', ');
        }

        async function updateProfile() {
            const name = document.getElementById('editProfileName').value;
            const bio = document.getElementById('editProfileBio').value;
            const address = document.getElementById('editProfileAddress').value;
            const books = document.getElementById('editProfileBooks').value.split(',').map(book => book.trim());

            const response = await fetch('/update-profile', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: currentUser.username, name, bio, address, books }),
            });
            if (response.ok) {
                currentUser.name = name;
                currentUser.bio = bio;
                currentUser.address = address;
                currentUser.books = books;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showProfileView();
            } else {
                alert('Failed to update profile');
            }
        }

        function showProfileView() {
            document.getElementById('profileEdit').style.display = 'none';
            document.getElementById('profileView').style.display = 'block';

            document.getElementById('viewProfileName').innerText = currentUser.name || 'No name set';
            document.getElementById('viewProfileBio').innerText = currentUser.bio || 'No bio set';
            document.getElementById('viewProfileAddress').innerText = currentUser.address || 'No address set';
            updateBooksView(currentUser.books || []);
        }

        function updateBooksView(books) {
            const booksList = document.getElementById('viewProfileBooks');
            booksList.innerHTML = '';
            books.forEach(book => {
                const listItem = document.createElement('li');
                listItem.textContent = book;
                booksList.appendChild(listItem);
            });
        }
    </script>
    <script src="footer.js"></script>
</body>
</html>
